{"version":3,"file":"plugin.js","sources":["../../../../src/vanilla.ts","../../../../src/plugins/caret_position/plugin.ts"],"sourcesContent":["\nimport { iterate } from '@orchidjs/sifter/lib/utils';\n\n/**\n * Return a dom element from either a dom query string, jQuery object, a dom element or html string\n * https://stackoverflow.com/questions/494143/creating-a-new-dom-element-from-an-html-string-using-built-in-dom-methods-or-pro/35385518#35385518\n *\n * param query should be {}\n */\nexport const getDom = ( query:any ):HTMLElement => {\n\n\tif( query.jquery ){\n\t\treturn query[0];\n\t}\n\n\tif( query instanceof HTMLElement ){\n\t\treturn query;\n\t}\n\n\tif( isHtmlString(query) ){\n\t\tvar tpl = document.createElement('template');\n\t\ttpl.innerHTML = query.trim(); // Never return a text node of whitespace as the result\n\t\treturn tpl.content.firstChild as HTMLElement;\n\t}\n\n\treturn document.querySelector(query);\n};\n\nexport const isHtmlString = (arg:any): boolean => {\n\tif( typeof arg === 'string' && arg.indexOf('<') > -1 ){\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nexport const escapeQuery = (query:string):string => {\n\treturn query.replace(/['\"\\\\]/g, '\\\\$&');\n}\n\n/**\n * Dispatch an event\n *\n */\nexport const triggerEvent = ( dom_el:HTMLElement, event_name:string ):void => {\n\tvar event = document.createEvent('HTMLEvents');\n\tevent.initEvent(event_name, true, false);\n\tdom_el.dispatchEvent(event)\n};\n\n/**\n * Apply CSS rules to a dom element\n *\n */\nexport const applyCSS = ( dom_el:HTMLElement, css:{ [key: string]: string|number }):void => {\n\tObject.assign(dom_el.style, css);\n}\n\n\n/**\n * Add css classes\n *\n */\nexport const addClasses = ( elmts:HTMLElement|HTMLElement[], ...classes:string[]|string[][] ) => {\n\n\tvar norm_classes \t= classesArray(classes);\n\telmts\t\t\t\t= castAsArray(elmts);\n\n\telmts.map( el => {\n\t\tnorm_classes.map( cls => {\n\t\t\tel.classList.add( cls );\n\t\t});\n\t});\n}\n\n/**\n * Remove css classes\n *\n */\n export const removeClasses = ( elmts:HTMLElement|HTMLElement[], ...classes:string[]|string[][] ) => {\n\n \tvar norm_classes \t= classesArray(classes);\n\telmts\t\t\t\t= castAsArray(elmts);\n\n\telmts.map( el => {\n\t\tnorm_classes.map(cls => {\n\t \t\tel.classList.remove( cls );\n\t\t});\n \t});\n }\n\n\n/**\n * Return arguments\n *\n */\nexport const classesArray = (args:string[]|string[][]):string[] => {\n\tvar classes:string[] = [];\n\titerate( args, (_classes) =>{\n\t\tif( typeof _classes === 'string' ){\n\t\t\t_classes = _classes.trim().split(/[\\11\\12\\14\\15\\40]/);\n\t\t}\n\t\tif( Array.isArray(_classes) ){\n\t\t\tclasses = classes.concat(_classes);\n\t\t}\n\t});\n\n\treturn classes.filter(Boolean);\n}\n\n\n/**\n * Create an array from arg if it's not already an array\n *\n */\nexport const castAsArray = (arg:any):Array<any> => {\n\tif( !Array.isArray(arg) ){\n \t\targ = [arg];\n \t}\n\treturn arg;\n}\n\n\n/**\n * Get the closest node to the evt.target matching the selector\n * Stops at wrapper\n *\n */\nexport const parentMatch = ( target:null|HTMLElement, selector:string, wrapper?:HTMLElement ):HTMLElement|void => {\n\n\tif( wrapper && !wrapper.contains(target) ){\n\t\treturn;\n\t}\n\n\twhile( target && target.matches ){\n\n\t\tif( target.matches(selector) ){\n\t\t\treturn target;\n\t\t}\n\n\t\ttarget = target.parentNode as HTMLElement;\n\t}\n}\n\n\n/**\n * Get the first or last item from an array\n *\n * > 0 - right (last)\n * <= 0 - left (first)\n *\n */\nexport const getTail = ( list:Array<any>|NodeList, direction:number=0 ):any => {\n\n\tif( direction > 0 ){\n\t\treturn list[list.length-1];\n\t}\n\n\treturn list[0];\n}\n\n/**\n * Return true if an object is empty\n *\n */\nexport const isEmptyObject = (obj:object):boolean => {\n\treturn (Object.keys(obj).length === 0);\n}\n\n\n/**\n * Get the index of an element amongst sibling nodes of the same type\n *\n */\nexport const nodeIndex = ( el:null|Element, amongst?:string ):number => {\n\tif (!el) return -1;\n\n\tamongst = amongst || el.nodeName;\n\n\tvar i = 0;\n\twhile( el = el.previousElementSibling ){\n\n\t\tif( el.matches(amongst) ){\n\t\t\ti++;\n\t\t}\n\t}\n\treturn i;\n}\n\n\n/**\n * Set attributes of an element\n *\n */\nexport const setAttr = (el:Element,attrs:{ [key: string]: null|string|number }) => {\n\titerate( attrs,(val,attr) => {\n\t\tif( val == null ){\n\t\t\tel.removeAttribute(attr as string);\n\t\t}else{\n\t\t\tel.setAttribute(attr as string, ''+val);\n\t\t}\n\t});\n}\n\n\n/**\n * Replace a node\n */\nexport const replaceNode = ( existing:Node, replacement:Node ) => {\n\tif( existing.parentNode ) existing.parentNode.replaceChild(replacement, existing);\n}\n","/**\n * Plugin: \"dropdown_input\" (Tom Select)\n * Copyright (c) contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this\n * file except in compliance with the License. You may obtain a copy of the License at:\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF\n * ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n *\n */\n\nimport TomSelect from '../../tom-select';\nimport { nodeIndex, removeClasses } from '../../vanilla';\n\n\nexport default function(this:TomSelect) {\n\tvar self = this;\n\n\t/**\n\t * Moves the caret to the specified index.\n\t *\n\t * The input must be moved by leaving it in place and moving the\n\t * siblings, due to the fact that focus cannot be restored once lost\n\t * on mobile webkit devices\n\t *\n\t */\n\tself.hook('instead','setCaret',(new_pos:number) => {\n\n\t\tif( self.settings.mode === 'single' || !self.control.contains(self.control_input) ) {\n\t\t\tnew_pos = self.items.length;\n\t\t} else {\n\t\t\tnew_pos = Math.max(0, Math.min(self.items.length, new_pos));\n\n\t\t\tif( new_pos != self.caretPos && !self.isPending ){\n\n\t\t\t\tself.controlChildren().forEach((child,j) => {\n\t\t\t\t\tif( j < new_pos ){\n\t\t\t\t\t\tself.control_input.insertAdjacentElement('beforebegin', child );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.control.appendChild( child );\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tself.caretPos = new_pos;\n\t});\n\n\tself.hook('instead','moveCaret',(direction:number) => {\n\n\t\tif( !self.isFocused ) return;\n\n\t\t// move caret before or after selected items\n\t\tconst last_active\t\t= self.getLastActive(direction);\n\t\tif( last_active ){\n\t\t\tconst idx = nodeIndex(last_active);\n\t\t\tself.setCaret(direction > 0 ? idx + 1: idx);\n\t\t\tself.setActiveItem();\n\t\t\tremoveClasses(last_active as HTMLElement,'last-active');\n\n\t\t// move caret left or right of current position\n\t\t}else{\n\t\t\tself.setCaret(self.caretPos + direction);\n\n\t\t}\n\n\t});\n\n};\n"],"names":["removeClasses","elmts","classes","norm_classes","classesArray","castAsArray","map","el","cls","classList","remove","args","iterate","_classes","trim","split","Array","isArray","concat","filter","Boolean","arg","nodeIndex","amongst","nodeName","i","previousElementSibling","matches","self","hook","new_pos","settings","mode","control","contains","control_input","items","length","Math","max","min","caretPos","isPending","controlChildren","forEach","child","j","insertAdjacentElement","appendChild","direction","isFocused","last_active","getLastActive","idx","setCaret","setActiveItem"],"mappings":"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"}